<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Preços de Exames Laboratoriais</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.min.js"></script>
  <style>
    :root {
      --primary-blue: #2563eb;
      --text-light: #6b7280;
      --text-dark: #111827;
      --accent-green: #10b981;
      --accent-purple: #7c3aed;
      --background-light: #ffffff;
      --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      --input-border: #d1d5db;
      --error-red: #ef4444;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background-light);
      color: var(--text-dark);
      margin: 0;
      padding: 0;
    }
    .main-container {
      padding: 2rem;
      max-width: 78rem;
      margin: 0 auto;
    }
    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    .logo-container img {
      max-width: 150px;
      height: auto;
    }
    .logo-container.right img {
      max-width: 200px;
    }
    .title-container {
      text-align: center;
      flex: 1;
    }
    h1, h2 {
      color: var(--primary-blue);
      font-weight: 600;
      margin: 0;
    }
    h1 {
      font-size: 1.875rem;
    }
    h2 {
      font-size: 1.25rem;
    }
    .card {
      background: white;
      border-radius: 0.75rem;
      box-shadow: var(--card-shadow);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .custom-input {
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      padding: 0.75rem 2.5rem;
      width: 50%;
      font-size: 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .custom-input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    .custom-input:disabled {
      background-color: #f3f4f6;
      cursor: not-allowed;
    }
    .custom-input.error {
      border-color: var(--error-red);
    }
    .discount-input {
      width: 20%;
      min-width: 100px;
      padding: 0.75rem 2.5rem;
    }
    .custom-select {
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      padding: 0.75rem;
      width: 100%;
      font-size: 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .custom-select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    .search-container, .phone-container {
      position: relative;
      margin-bottom: 0.75rem;
    }
    .search-container i, .phone-container i {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      font-size: 1rem;
    }
    .search-container.responsible-container {
      max-width: 70rem;
    }
    .search-container.solicitante-container {
      max-width: 70rem;
    }
    .phone-container {
      max-width: 16rem;
    }
    .info-container {
      display: flex;
      flex-wrap: nowrap;
      gap: 1rem;
      margin-bottom: 0.75rem;
      justify-content: flex-start;
      background-color: #f0f7ff;
      padding: 1rem;
      border-radius: 0.75rem;
    }
    .info-container .search-container, .info-container .phone-container {
      flex: none;
      margin-bottom: 0.75rem;
    }
    .info-container .phone-container {
      min-width: 100px;
    }
    .info-container label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
    }
    .error-message {
      color: var(--error-red);
      font-size: 0.875rem;
      margin-top: 0.25rem;
      display: none;
    }
    #examListContainer {
      max-height: 200px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--primary-blue) #e5e7eb;
      display: none;
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      padding: 0.75rem;
    }
    #examListContainer::-webkit-scrollbar {
      width: 6px;
    }
    #examListContainer::-webkit-scrollbar-track {
      background: #e5e7eb;
    }
    #examListContainer::-webkit-scrollbar-thumb {
      background-color: var(--primary-blue);
      border-radius: 3px;
    }
    .exam-checkbox {
      padding: 0.5rem;
      display: flex;
      align-items: center;
      border-radius: 0.375rem;
      transition: background-color 0.3s ease;
    }
    .exam-checkbox:nth-child(even) {
      background-color: #f9fafb;
    }
    .exam-checkbox:hover {
      background-color: #eff6ff;
    }
    .exam-checkbox input {
      margin-right: 0.75rem;
      accent-color: var(--primary-blue);
    }
    .exam-checkbox label {
      color: var(--text-dark);
      font-size: 0.875rem;
    }
    .exam-checkbox label span {
      color: var(--accent-green);
      font-weight: 500;
    }
    .no-results {
      color: var(--text-light);
      text-align: center;
      padding: 1rem;
      font-size: 0.875rem;
    }
    .customQuitTable {
      width: 100%;
      border-collapse: collapse;
    }
    .customQuitTable th {
      background-color: var(--primary-blue);
      color: white;
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
    }
    .customQuitTable td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      font-size: 0.875rem;
    }
    .customQuitTable tr:hover {
      background-color: #f3f4f6;
    }
    .btn-primary, .btn-accent, .btn-danger, .btn-promo, .btn-update {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      color: white;
      font-weight: 500;
      font-size: 1rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      border: none;
    }
    .btn-primary {
      background: linear-gradient(to right, var(--primary-blue), #3b82f6);
    }
    .btn-primary:hover {
      background: linear-gradient(to right, #1e40af, #2563eb);
      transform: translateY(-2px);
    }
    .btn-accent {
      background: linear-gradient(to right, var(--accent-green), #34d399);
    }
    .btn-accent:hover {
      background: linear-gradient(to right, #059669, #10b981);
      transform: translateY(-2px);
    }
    .btn-danger {
      background: linear-gradient(to right, #ef4444, #f87171);
    }
    .btn-danger:hover {
      background: linear-gradient(to right, #dc2626, #ef4444);
      transform: translateY(-2px);
    }
    .btn-promo {
      background: linear-gradient(to right, var(--accent-purple), #a78bfa);
    }
    .btn-promo:hover {
      background: linear-gradient(to right, #6d28d9, #7c3aed);
      transform: translateY(-2px);
    }
    .btn-update {
      background: linear-gradient(to right, #f59e0b, #fbbf24);
    }
    .btn-update:hover {
      background: linear-gradient(to right, #d97706, #f59e0b);
      transform: translateY(-2px);
    }
    .summary-card {
      background-color: #f0f7ff;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .summary-card p {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
      margin: 0.5rem 0;
    }
    .summary-card .final-price {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary-blue);
    }
    .summary-card i.fa-money-bill-wave {
      color: var(--accent-green);
    }
    .summary-card i.fa-percentage {
      color: var(--accent-green);
    }
    .summary-card i.fa-star {
      color: var(--accent-purple);
    }
    .summary-card i.fa-wallet {
      color: var(--primary-blue);
    }
    .space-y-3 > * + * {
      margin-top: 0.75rem;
    }
    #discountSection {
      transition: max-height 0.5s ease, opacity 0.5s ease;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
    }
    #discountSection.active {
      max-height: 800px;
      opacity: 1;
    }
    .button-container {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }
    .print-controls {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-top: 0.0rem;
    }
    .print-controls .search-container {
      max-width: 240px;
      flex: 0 0 auto;
    }
    .print-controls .custom-select {
      padding: 0.75rem;
      font-size: 1rem;
    }
    .discount-container {
      margin: 1rem 0;
    }
    .promo-details {
      display: none;
      margin-top: 1rem;
      gap: 1rem;
      flex-wrap: nowrap;
      align-items: flex-start;
    }
    .promo-details.active {
      display: flex;
    }
    .promo-details .search-container {
      flex: 1;
      max-width: 200px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .promo-details .search-container select,
    .promo-details .search-container input {
      width: 100%;
      box-sizing: border-box;
    }
    .space {
      height: 1rem;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 0.75rem;
      padding: 2rem;
      width: 100%;
      max-width: 500px;
      box-shadow: var(--card-shadow);
      position: relative;
    }
    .modal-content h2 {
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .modal-content .close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
    }
    .modal-content .logo-container {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .modal-content .logo-container img {
      max-width: 120px;
    }
    .modal-content .form-group {
      margin-bottom: 1rem;
    }
    .modal-content .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    .modal-content .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      font-size: 1rem;
    }
    .modal-content .error-message {
      display: block;
      text-align: center;
    }
    .price-management {
      display: none;
      margin-top: 2rem;
    }
    .price-management.active {
      display: block;
    }
    .price-management .form-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .price-management .form-group input {
      flex: 1;
    }
    .price-management .exam-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .price-management .exam-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      border-bottom: 1px solid #e5e7eb;
    }
    .price-management .exam-item:last-child {
      border-bottom: none;
    }
    .price-management .exam-item button {
      background: none;
      border: none;
      color: var(--error-red);
      cursor: pointer;
      font-size: 1rem;
    }
    @media (max-width: 640px) {
      .main-container {
        padding: 1rem;
      }
      .header-container {
        flex-direction: column;
        gap: 1rem;
      }
      .logo-container img {
        max-width: 100px;
      }
      .logo-container.right img {
        max-width: 150px;
      }
      h1 {
        font-size: 1.5rem;
      }
      h2 {
        font-size: 1.125rem;
      }
      .info-container {
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem;
      }
      .info-container .search-container, .info-container .phone-container {
        max-width: 100%;
        margin-bottom: 0.5rem;
      }
      .btn-primary, .btn-accent, .btn-danger, .btn-promo, .btn-update {
        width: 100%;
        justify-content: center;
      }
      .button-container {
        flex-direction: column;
      }
      .print-controls {
        flex-direction: column;
        align-items: stretch;
      }
      .print-controls .search-container {
        max-width: 100%;
      }
      .promo-details.active {
        flex-direction: column;
      }
      .promo-details .search-container {
        max-width: 100%;
      }
      .discount-input {
        width: 100%;
        min-width: unset;
      }
      .modal-content {
        margin: 1rem;
        padding: 1.5rem;
      }
      .price-management .form-group {
        flex-direction: column;
      }
    }
    @media print {
      .btn-primary, .btn-accent, .btn-danger, .btn-promo, .btn-update {
        display: none !important;
      }
      .no-print {
        display: none;
      }
      .cpf-container {
        max-width: 16rem;
      }
      .delete-exam-btn {
        background-color: #ef4444;
        color: white;
        border: none;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        cursor: pointer;
        font-size: 0.875rem;
        display: inline-flex;
        align-items: center;
      }
      .delete-exam-btn:hover {
        background-color: #dc2626;
      }
      .action-cell {
        text-align: center;
        width: 60px;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="header-container">
      <div class="logo-container">
        <img src="img/sesi.jpg" alt="Logo do SESI" aria-label="Logotipo do SESI">
      </div>
      <div class="title-container">
        <h1>Consulta Preços de Exames e Especialidades</h1>
      </div>
      <div class="logo-container right">
        <img src="img/melhoria.jpg" alt="Melhoria Logo" aria-label="Logotipo da Melhoria">
      </div>
    </div>
    <div class="card">
      <div class="search-container mx-auto">
        <input type="text" id="examSearch" class="custom-input" placeholder="Digite o nome do exame" aria-label="Digite o nome do exame para filtrar">
        <i class="fas fa-search"></i>
      </div>
    </div>
    <div class="card">
      <h2 class="text-center mb-6">Selecionar Exames</h2>
      <div id="examListContainer"></div>
    </div>
    <div class="card">
      <div class="flex justify-between items-center mb-6">
        <h2>Exames Selecionados</h2>
        <button id="clearSelection" class="btn-danger" aria-label="Limpar todos os exames selecionados">
          <i class="fas fa-trash mr-2"></i> Limpar
        </button>
      </div>
      <div class="space"></div>
      <div class="max-h-80 overflow-y-auto">
        <table class="customQuitTable">
          <thead>
            <tr>
              <th>Exame</th>
              <th>Preço (R$)</th>
              <th class="action-cell">Excluir</th>
            </tr>
          </thead>
          <tbody id="selectedExamTable"></tbody>
        </table>
      </div>
    </div>
    <div class="summary-card">
      <h2 class="mb-6">Resumo</h2>
      <div class="space"></div>
      <div class="space-y-3">
        <p><i class="fas fa-money-bill-wave"></i> Valor Total: R$ <span id="totalPrice" class="font-semibold">0,00</span></p>
        <p><i class="fas fa-percentage"></i> Desconto Indústria: R$ <span id="discountValue" class="font-semibold">0,00</span> (<span id="discountPercent" class="font-semibold">0</span>%)</p>
        <p><i class="fas fa-star"></i> Desconto Promocional: R$ <span id="promoDiscountValue" class="font-semibold">0,00</span> (<span id="promoDiscountPercent" class="font-semibold">0</span>%)</p>
        <p class="final-price"><i class="fas fa-wallet"></i> Valor Final: R$ <span id="finalPrice" class="font-semibold">0,00</span></p>
      </div>
      <div class="space"></div>
      <div class="mt-6">
        <h2 class="mb-6">Informações</h2>
        <div class="space"></div>
        <div class="info-container">
          <div class="search-container responsible-container">
            <label for="responsibleInput">Responsável pelo Orçamento</label>
            <input type="text" id="responsibleInput" class="custom-input" placeholder="Nome responsável" aria-label="Digite o nome do responsável">
            <i class="fas fa-user"></i>
          </div>
          <div class="search-container solicitante-container">
            <label for="solicitanteInput">Solicitante</label>
            <input type="text" id="solicitanteInput" class="custom-input" placeholder="Nome solicitante" aria-label="Digite o nome do solicitante">
            <i class="fas fa-user"></i>
          </div>
          <div class="phone-container">
            <label for="telefoneInput">Telefone do Solicitante</label>
            <input type="tel" id="telefoneInput" class="custom-input" placeholder="Contato" aria-label="Digite o número de telefone (10 ou 11 dígitos)" pattern="^\d{10,11}$">
            <i class="fas fa-phone"></i>
            <div id="phoneError" class="error-message">Digite apenas Números</div>
          </div>
          <div class="cpf-container">
            <label for="cpfInput">CPF do Solicitante</label>
            <input type="text" id="cpfInput" class="custom-input" placeholder="CPF do solicitante" aria-label="Digite o CPF do solicitante (11 dígitos)" pattern="\d{11}">
            <i class="fas fa-id-card"></i>
            <div id="cpfError" class="error-message">Digite um CPF válido</div>
          </div>
        </div>
      </div>
      <div class="print-controls">
        <button id="printButton" class="btn-primary w-full sm:w-auto" aria-label="Imprimir resumo">
          <i class="fas fa-print mr-2"></i> Imprimir Resumo
        </button>
        <div class="search-container">
          <label for="printType">Tipo de Impressão</label>
          <select id="printType" class="custom-select" aria-label="Selecione o tipo de impressão">
            <option value="standard">Impressora Padrão</option>
            <option value="thermal">Impressora Térmica</option>
          </select>
        </div>
        <button id="updateTableButton" class="btn-update w-full sm:w-auto" aria-label="Atualizar tabela">
          <i class="fas fa-lock mr-2"></i> Atualizar Tabela
        </button>
      </div>
    </div>
    <div class="card">
      <button id="discountToggle" class="btn-primary w-full sm:w-auto" aria-label="Adicionar Desconto">
        <i class="fas fa-percent mr-2"></i> Adicionar Desconto
      </button>
      <div id="discountSection" class="mt-4">
        <div class="discount-container">
          <label for="discountInput" class="block text-center font-medium mb-2">
            <input type="checkbox" id="enableIndustryDiscount" aria-label="Habilitar desconto Indústria"> Desconto Indústria
          </label>
          <div class="search-container mx-auto">
            <input type="number" id="discountInput" min="0" max="70" step="0.01" placeholder="Ex.: 10,00" class="custom-input discount-input" aria-label="Desconto percentual da indústria" disabled>
            <i class="fas fa-percent"></i>
            <div id="discountInputError" class="error-message">Digite um valor em %</div>
          </div>
        </div>
        <div class="discount-container">
          <label for="promoDiscountInput" class="block text-center font-medium mb-2">
            <input type="checkbox" id="enablePromoDiscount" aria-label="Habilitar desconto promocional"> Desconto Promocional
          </label>
          <div class="search-container mx-auto">
            <input type="number" id="promoDiscountInput" min="0" max="25" step="0.01" placeholder="Ex.: 0,00" class="custom-input discount-input" aria-label="Desconto percentual da promoção" disabled>
            <i class="fas fa-star"></i>
            <div id="promoDiscountInputError" class="error-message">Digite um valor em%</div>
          </div>
          <div id="promoDetails" class="promo-details">
            <div class="search-container">
              <label for="promoType">Seleção de promoção</label>
              <select id="promoType" class="custom-select" aria-label="Tipo de promoção" disabled>
                <option value="" disabled selected>Seleção de promoção</option>
                <option value="BlackFriday">Black Friday</option>
                <option value="Semana do Consumidor">Semana do Consumidor</option>
                <option value="Outros">Outros</option>
              </select>
            </div>
            <div class="search-container">
              <label for="promoStartDate">Data de Início</label>
              <input type="date" id="promoStartDate" class="custom-input" aria-label="Digite a data de início da promoção" disabled>
              <i class="fas fa-calendar-alt"></i>
              <div id="promoStartDateError" class="error-message">Data de início inválida</div>
            </div>
            <div class="search-container">
              <label for="promoEndDate">Data de Término</label>
              <input type="date" id="promoEndDate" class="custom-input" aria-label="Digite a data de término da promoção" disabled>
              <i class="fas fa-calendar-alt"></i>
              <div id="promoEndDateError" class="error-message">A data de término não pode ser anterior à data de início</div>
            </div>
            <div class="search-container" id="otherPromoContainer" style="display:none;">
              <label for="otherPromoInput">Outra Promoção</label>
              <input type="text" id="otherPromoInput" class="custom-input" placeholder="Promoção" aria-label="Digite o tipo de promoção" disabled>
              <i class="fas fa-tag"></i>
            </div>
          </div>
        </div>
        <div class="button-container">
          <button id="applyDiscount" class="btn-accent" aria-label="Aplicar desconto Indústria">
            <i class="fas fa-check mr-2"></i> Aplicar Desconto
          </button>
          <button id="applyPromoDiscount" class="btn-promo" aria-label="Aplicar desconto promocional">
            <i class="fas fa-star mr-2"></i> Aplicar Promoção
          </button>
        </div>
      </div>
    </div>
    <div id="modal-container">
      <div id="loginModal" class="modal">
        <div class="modal-content">
          <span class="close" aria-label="Fechar modal">×</span>
          <div class="logo-container">
            <img src="img/sesi.jpg" alt="Logo do SESI" aria-label="Logotipo do SESI">
          </div>
          <h2>Autenticação</h2>
          <div class="form-group">
            <label for="username">Usuário</label>
            <input type="text" id="username" placeholder="Digite o usuário" aria-label="Digite o nome de usuário">
          </div>
          <div class="form-group">
            <label for="password">Senha</label>
            <input type="password" id="password" placeholder="Digite a senha" aria-label="Digite a senha">
          </div>
          <div id="loginError" class="error-message">Usuário ou senha incorretos</div>
          <div class="button-container">
            <button id="loginButton" class="btn-primary">Entrar</button>
          </div>
          <div id="priceManagement" class="price-management">
            <h2>Gerenciamento de Preços</h2>
            <div class="form-group">
              <input type="text" id="newExamName" placeholder="Nome do exame" aria-label="Digite o nome do novo exame">
              <input type="number" id="newExamPrice" placeholder="Preço (R$)" step="0.01" min="0" aria-label="Digite o preço do novo exame">
              <button id="addExamButton" class="btn-accent" aria-label="Adicionar novo exame"><i class="fas fa-plus"></i> Adicionar</button>
            </div>
            <div class="form-group">
              <input type="file" id="excelUpload" accept=".xlsx,.xls" aria-label="Carregar arquivo Excel">
              <button id="uploadExcelButton" class="btn-primary" aria-label="Carregar planilha Excel"><i class="fas fa-upload"></i> Carregar Excel</button>
            </div>
            <div class="exam-list" id="examList"></div>
            <div class="button-container">
              <button id="saveButton" class="btn-accent" aria-label="Salvar alterações"><i class="fas fa-save"></i> Salvar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    const initialExams = [
  { name: "Abertura Coronária e Encaminhamento para Endodontia", price: 60.00 },
  { name: "Acetilcolinesterase Plasmática", price: 20.00 },
  { name: "Ácido 2 Etoxiacético", price: 949.00 },
  { name: "Ácido Fenilglioxílico (Final da Jornada de Trabalho)", price: 41.00 },
  { name: "Ácido Fólico", price: 72.00 },
  { name: "Ácido Fórmico", price: 110.00 },
  { name: "Ácido Láctico", price: 100.00 },
  { name: "Ácido S-Fenilmercaptúrico", price: 388.00 },
  { name: "Ácido Tricloroacético", price: 99.00 },
  { name: "Ácido Úrico", price: 20.00 },
  { name: "Acuidade Visual", price: 22.00 },
  { name: "Albumina", price: 20.00 },
  { name: "Aldolase", price: 28.00 },
  { name: "Alfa 1 Glicoproteína Ácida", price: 41.00 },
  { name: "Alfa-Fetoproteína", price: 66.00 },
  { name: "Alveoloplastia (Por Segmento)", price: 160.00 },
  { name: "Amilase", price: 66.00 },
  { name: "Anticorpo Anti-Microssomal ou Anti-TPO ou Anti PER", price: 20.00 },
  { name: "Anticorpos Anti HIV1 + HIV2 (Triagem)", price: 75.00 },
  { name: "Anticorpos Anti HIV1 + HIV2 Western Blot - Teste", price: 392.00 },
  { name: "Anticorpos Anti Tireoglobulina", price: 77.00 },
  { name: "Antiestreptolisina O", price: 20.00 },
  { name: "Antígeno Carcinoembrionário - (CEA)", price: 62.00 },
  { name: "Aparelho Ortodôntico Fixo (Corretivo – Superior/Inferior)", price: 477.00 },
  { name: "Aparelho Ortodôntico Fixo (Movimentação com Finalidade Protética – Por Arcada)", price: 457.00 },
  { name: "Aparelho Ortodôntico Fixo (Porcelana)", price: 953.00 },
  { name: "Aparelho Ortodôntico Fixo (Safira)", price: 1655.00 },
  { name: "Aparelho Ortodôntico Móvel (Movimentação com Finalidade Protética – Por Arcada)", price: 325.00 },
  { name: "Aparelho Ortodôntico Móvel (Preventivo e Interceptativo – Superior/Inferior)", price: 433.00 },
  { name: "Apicectomia (Incisivo ou Canino)", price: 271.00 },
  { name: "Apicectomia (Molar)", price: 325.00 },
  { name: "Apicectomia (Pré-Molar)", price: 310.00 },
  { name: "Aplicação Tópica de Flúor (Arco Superior e Inferior)", price: 63.00 },
  { name: "Arco Lingual", price: 271.00 },
  { name: "Atendimento Psicológico", price: 104.00 },
  { name: "Audiometria", price: 30.00 },
  { name: "Audiometria com Discriminação Vocal", price: 115.00 },
  { name: "Audiometria Clínica Não Ocupacional", price: 55.00 },
  { name: "Aumento de Coroa Clínica", price: 250.00 },
  { name: "Avaliação Psicológica - Serviço", price: 196.00 },
  { name: "Avaliação Psicossocial - Serviço", price: 77.00 },
  { name: "Avaliação Psicossocial para Condição Diferenciada de Trabalho", price: 77.00 },
  { name: "Bacterioscopia a Fresco", price: 24.00 },
  { name: "Bacterioscopia a Fresco (Secreção Uretral)", price: 24.00 },
  { name: "Bacterioscopia a Fresco (Secreção Vaginal)", price: 24.00 },
  { name: "Bacterioscopia Gram (Outros Materiais)", price: 24.00 },
  { name: "Bacterioscopia Orofaringe", price: 24.00 },
  { name: "Barra 3x3", price: 232.00 },
  { name: "Barra Transpalatina Fixa", price: 334.00 },
  { name: "Barra Transpalatina Removível", price: 210.00 },
  { name: "BHCG ou Beta HCG - Quantitativo", price: 41.00 },
  { name: "Bilirrubina Total e Frações", price: 20.00 },
  { name: "Botão de Nance Fixo Superior", price: 334.00 },
  { name: "Brucelose", price: 24.00 },
  { name: "CA (Cálcio)", price: 20.00 },
  { name: "CA 125", price: 79.00 },
  { name: "CA 15-3", price: 79.00 },
  { name: "CA 19-9", price: 79.00 },
  { name: "CA 50", price: 102.00 },
  { name: "CA 72-4", price: 185.00 },
  { name: "Capacidade de Fixação do Ferro", price: 43.00 },
  { name: "Capeamento Direto ou Indireto", price: 38.00 },
  { name: "Censo Bucal", price: 51.00 },
  { name: "Ceruloplasmina", price: 47.00 },
  { name: "Chagas - Imunofluorescência - (IgG)", price: 29.00 },
  { name: "Chagas - Imunofluorescência - (IgM)", price: 28.00 },
  { name: "Chikungunya-Sorologia Total - IgG", price: 146.00 },
  { name: "Chikungunya-Sorologia Total - IgM", price: 146.00 },
  { name: "Chlamidya Trachomatis - IgG", price: 62.00 },
  { name: "Chlamidya Trachomatis IgM", price: 77.00 },
  { name: "Cimentação de Coroa Fixa (Definitiva)", price: 150.00 },
  { name: "Cimentação de Coroa Fixa (Provisória)", price: 120.00 },
  { name: "Cirurgia para Exposição para Tracionamento Ortodôntico", price: 350.00 },
  { name: "Cirurgia Periodontal a Retalho (Descontaminação por Segmento)", price: 300.00 },
  { name: "Citologia Oncótica", price: 47.00 },
  { name: "Citomegalovirus IgG", price: 51.00 },
  { name: "Citomegalovirus IgM", price: 51.00 },
  { name: "Clareamento Associado em Dentes Vitalizados (Técnica Combinada: Consultório + Caseiro)", price: 1300.00 },
  { name: "Clareamento Dente Desvitalizado (Por Elemento)", price: 281.00 },
  { name: "Clareamento Dente Vitalizado (Técnica: Caseiro)", price: 500.00 },
  { name: "Clareamento Dente Vitalizado (Técnica: Consultório)", price: 960.00 },
  { name: "Cloro", price: 22.00 },
  { name: "Coagulograma", price: 20.00 },
  { name: "Colesterol - Fita", price: 24.00 },
  { name: "Colesterol Total", price: 20.00 },
  { name: "Colinesterase em Sangue", price: 43.00 },
  { name: "Colinesterase em Soro", price: 50.00 },
  { name: "Colinesterase Eritrocitária - Acetilcolinesterase", price: 44.00 },
  { name: "Combo - Consulta Nutricional (6 Consultas)", price: 239.00 },
  { name: "Combo Coração - Colesterol Total", price: 13.00 },
  { name: "Combo Coração - Consulta - Cardiologia", price: 120.00 },
  { name: "Combo Coração - Creatina Fosfoquinase - CK ou Creatino-Quinase O", price: 13.00 },
  { name: "Combo Coração - Creatinina", price: 13.00 },
  { name: "Combo Coração - Glicose", price: 13.00 },
  { name: "Combo Coração - HDL", price: 13.00 },
  { name: "Combo Coração - Hemoglobina Glicosilada", price: 13.00 },
  { name: "Combo Coração - Hemograma Completo", price: 13.00 },
  { name: "Combo Coração - K (Potássio)", price: 13.00 },
  { name: "Combo Coração - LDL", price: 13.00 },
  { name: "Combo Coração - Sumário de Urina", price: 13.00 },
  { name: "Combo Coração - TGO - Transaminase Oxaloacética", price: 13.00 },
  { name: "Combo Coração - TGP - Transaminase Pirúvica", price: 13.00 },
  { name: "Combo Coração - Triglicérides", price: 13.00 },
  { name: "Combo Coração - Uréia", price: 13.00 },
  { name: "Combo Coração - VLDL", price: 13.00 },
  { name: "Combo de Atendimento Clínico de Psicologia", price: 358.00 },
  { name: "Combo Otorrino - Consulta - Otorrinolaringologia", price: 120.00 },
  { name: "Combo Otorrino - Impedanciometria", price: 64.00 },
  { name: "Combo Pré-Cirúrgico - Consulta - Nutricionista", price: 48.00 },
  { name: "Combo Pré-Cirúrgico - Consulta - Psicológica", price: 48.00 },
  { name: "Combo Prev Feminina - Citologia Oncótica", price: 18.00 },
  { name: "Combo Prev Feminina - Consulta - Ginecologia", price: 120.00 },
  { name: "Combo Prev Feminina - Exame Colposcopia", price: 19.00 },
  { name: "Complemento C3", price: 37.00 },
  { name: "Complemento C4", price: 37.00 },
  { name: "Complemento Total CH50", price: 60.00 },
  { name: "Condicionamento em Odontologia – Até 03 Sessões (Criança)", price: 90.00 },
  { name: "Conserto de Prótese (Acrílico)", price: 150.00 },
  { name: "Conserto de Prótese (Elemento)", price: 100.00 },
  { name: "Consulta - Cardiologia", price: 119.00 },
  { name: "Consulta - Clínica Geral", price: 119.00 },
  { name: "Consulta - Dermatologia", price: 119.00 },
  { name: "Consulta - Ginecologia", price: 119.00 },
  { name: "Consulta - Nutricionista", price: 107.00 },
  { name: "Consulta - Oftalmológica", price: 119.00 },
  { name: "Consulta - Oftalmológica + Teste de Ishihara", price: 146.00 },
  { name: "Consulta - Ortopedia", price: 119.00 },
  { name: "Consulta - Otorrinolaringologia", price: 119.00 },
  { name: "Consulta - Pneumologia", price: 119.00 },
  { name: "Consulta - Psicológica", price: 107.00 },
  { name: "Consulta - Urologia", price: 119.00 },
  { name: "Consulta Odontológica (Inicial)", price: 20.00 },
  { name: "Consulta Odontológica (Ocupacional)", price: 50.00 },
  { name: "Contagem de Plaquetas", price: 20.00 },
  { name: "Coombs Direto", price: 24.00 },
  { name: "Coombs Indireto", price: 30.00 },
  { name: "Coprocultura (Fezes)", price: 57.00 },
  { name: "Coroa Provisória em Resina (Por Elemento)", price: 200.00 },
  { name: "Coroa Total em Zircônia (Por Elemento)", price: 1500.00 },
  { name: "Coroa Total Metalo-Cerâmica (Por Elemento)", price: 850.00 },
  { name: "Coronavírus 2019 Detecção por PCR", price: 169.00 },
  { name: "Cortisol", price: 60.00 },
  { name: "Creatina Fosfoquinase - CK ou Creatino-Quinase O", price: 30.00 },
  { name: "Creatina Quinase - MB Creatinoquinase-Fração", price: 55.00 },
  { name: "Creatinina", price: 20.00 },
  { name: "Creatinina na Urina", price: 20.00 },
  { name: "Cromo Sérico / Sanguíneo / Soro", price: 88.00 },
  { name: "Cromo Urinário Início de Jornada de Trabalho", price: 103.00 },
  { name: "Cultura (Em Geral)", price: 50.00 },
  { name: "Cultura de Escarro", price: 50.00 },
  { name: "Cultura de Líquido Seminal (Sêmen)", price: 50.00 },
  { name: "Cultura de Orofaringe", price: 50.00 },
  { name: "Cultura de Secreção - Abscesso", price: 50.00 },
  { name: "Cultura de Secreção Nasal", price: 50.00 },
  { name: "Cultura de Secreção Ocular", price: 50.00 },
  { name: "Cultura de Secreção Uretral", price: 50.00 },
  { name: "Cultura de Secreção Vaginal", price: 50.00 },
  { name: "Cultura para Fungos", price: 66.00 },
  { name: "Cultura para Neisseria", price: 79.00 },
  { name: "Cultura Secreção de Ouvido", price: 55.00 },
  { name: "Curativo", price: 40.00 },
  { name: "Dehidrotestosterona - DHT", price: 62.00 },
  { name: "Dengue-Sorologia Total (IgG)", price: 37.00 },
  { name: "Dengue-Sorologia Total (IgM)", price: 42.00 },
  { name: "Desidrogenase Láctica - LDH", price: 24.00 },
  { name: "Diclorometano", price: 235.00 },
  { name: "Disjuntor Palatino - Hyrax", price: 380.00 },
  { name: "Distalizador de Hilgers - Pendulum", price: 380.00 },
  { name: "Distalizador Tipo Jones - Jig", price: 380.00 },
  { name: "Dosagem de MEC Urinário", price: 43.00 },
  { name: "Dosagem de Pentaclorofenol Urinário", price: 482.00 },
  { name: "Dosagem de Tolueno no Sangue", price: 72.00 },
  { name: "Dosagem Toxicológica - 1-Hidroxipireno na Urina", price: 561.00 },
  { name: "Dosagem Toxicológica - 2,5 Hexanadiona", price: 64.00 },
  { name: "Dosagem Toxicológica - Acetona Urinária", price: 92.00 },
  { name: "Dosagem Toxicológica - Ácido Butoxiacético", price: 715.00 },
  { name: "Dosagem Toxicológica - Ácido Delta Aminolevulínico", price: 38.00 },
  { name: "Dosagem Toxicológica - Ácido Hipúrico (Para Tolueno)", price: 11.00 },
  { name: "Dosagem Toxicológica - Ácido Mandélico", price: 43.00 },
  { name: "Dosagem Toxicológica - Ácido Metil-Hipúrico (Para Xileno)", price: 11.00 },
  { name: "Dosagem Toxicológica - Ácido Trans-Muconico (Betab)", price: 63.00 },
  { name: "Dosagem Toxicológica - Arsênio", price: 515.00 },
  { name: "Dosagem Toxicológica - Cádmio", price: 93.00 },
  { name: "Dosagem Toxicológica - Carboxihemoglobina (Para Monóxido de Carbono)", price: 43.00 },
  { name: "Dosagem Toxicológica - Chumbo na Urina", price: 66.00 },
  { name: "Dosagem Toxicológica - Chumbo Sérico", price: 72.00 },
  { name: "Dosagem Toxicológica - Ciclohexanol Urinário", price: 203.00 },
  { name: "Dosagem Toxicológica - Cobalto", price: 20.00 },
  { name: "Dosagem Toxicológica - Cobre em Urina", price: 24.00 },
  { name: "Dosagem Toxicológica - Cobre Sérico", price: 26.00 },
  { name: "Dosagem Toxicológica - Creatinina na Urina", price: 24.00 },
  { name: "Dosagem Toxicológica - Cromo Urinário", price: 88.00 },
  { name: "Dosagem Toxicológica - Diclorometano", price: 191.00 },
  { name: "Dosagem Toxicológica - Etanol em Urina", price: 28.00 },
  { name: "Dosagem Toxicológica - Fenol por Cromatografia (Para Benzeno)", price: 38.00 },
  { name: "Dosagem Toxicológica - Fluoreto / Flúor", price: 43.00 },
  { name: "Dosagem Toxicológica - Manganês", price: 93.00 },
  { name: "Dosagem Toxicológica - Mercúrio", price: 93.00 },
  { name: "Dosagem Toxicológica - Metanol em Urina", price: 61.00 },
  { name: "Dosagem Toxicológica - Metil Isobutil Cetona", price: 67.00 },
  { name: "Dosagem Toxicológica - N.Metil-Etil-Cetona", price: 43.00 },
  { name: "Dosagem Toxicológica - Níquel", price: 93.00 },
  { name: "Dosagem Toxicológica - N-Metil Formamida em Urina", price: 147.00 },
  { name: "Dosagem Toxicológica - Orto Cresol", price: 78.00 },
  { name: "Dosagem Toxicológica - P-Aminofenol", price: 316.00 },
  { name: "Dosagem Toxicológica - Pentaclorofenol", price: 275.00 },
  { name: "Dosagem Toxicológica - Percloroetileno (Tetracloroetileno)", price: 224.00 },
  { name: "Dosagem Toxicológica - Tetrahidrofurano / Tetrahidro Urina / Óxido de Tetrametileno", price: 165.00 },
  { name: "Dosagem Toxicológica - Tiocianato em Urina", price: 157.00 },
  { name: "Dosagem Toxicológica - Triclorocompostos Totais (T)", price: 43.00 },
  { name: "Dosagem Toxicológica - Zinco em Urina", price: 93.00 },
  { name: "Dosagem Toxicológica - Zinco Sérico", price: 89.00 },
  { name: "Dosagem Toxicológica para Drogas de Abuso em Amostra de Queratina", price: 212.00 },
  { name: "Drenagem de Abscesso e Medicação", price: 100.00 },
  { name: "ECG - Eletrocardiograma com Laudo Cardiológico", price: 45.00 },
  { name: "EEG - Eletroencefalograma", price: 78.00 },
  { name: "Eletroforese das Proteínas", price: 50.00 },
  { name: "Eletroforese de Hemoglobinas", price: 51.00 },
  { name: "Eritrograma", price: 20.00 },
  { name: "Espirometria", price: 36.00 },
  { name: "Espirometria com Fluxo Expiratório Máximo - Peak Flow", price: 33.00 },
  { name: "Esquitossomose (Imunofluorescência)", price: 258.00 },
  { name: "Estradiol", price: 66.00 },
  { name: "Exame Colposcopia", price: 30.00 },
  { name: "Exame de Urina 24h", price: 19.00 },
  { name: "Excisão de Mucocele (de Desenvolvimento)", price: 250.00 },
  { name: "Exodontia de Elemento Dentário (Decíduo)", price: 120.00 },
  { name: "Exodontia de Elemento Dentário (Incluso)", price: 430.00 },
  { name: "Exodontia de Elemento Dentário (Resto Radicular ou a Retalho)", price: 190.00 },
  { name: "Exodontia de Elemento Dentário (Semi-Incluso ou Impactado)", price: 380.00 },
  { name: "Exodontia de Elemento Dentário (Simples)", price: 150.00 },
  { name: "Faceta Direta em Resina Fotopolimerizável (Por Elemento)", price: 300.00 },
  { name: "Fator Anti Nuclear - FAN", price: 30.00 },
  { name: "Fechamento de Diastema (Por Elemento)", price: 180.00 },
  { name: "Ferritina", price: 62.00 },
  { name: "Ferro Sérico", price: 20.00 },
  { name: "Fibrinogênio", price: 20.00 },
  { name: "Filaríose - Sorologia", price: 172.00 },
  { name: "Fosfatase Ácida", price: 22.00 },
  { name: "Fosfatase Alcalina", price: 20.00 },
  { name: "Fósforo", price: 20.00 },
  { name: "Frenectomia Inferior (Lingual)", price: 239.00 },
  { name: "Frenectomia Labial", price: 330.00 },
  { name: "Frenectomia Lingual", price: 350.00 },
  { name: "Frenectomia Superior (Labial)", price: 298.00 },
  { name: "Frutosamina", price: 24.00 },
  { name: "FTA-ABS", price: 71.00 },
  { name: "Gama GT", price: 20.00 },
  { name: "Gengivectomia (Por Arcada)", price: 382.00 },
  { name: "Gengivectomia (Por Segmento)", price: 382.00 },
  { name: "Glicose", price: 16.00 },
  { name: "Glicose 6-Fosfato Desidrogenase - G6PD", price: 30.00 },
  { name: "Glicose Fita", price: 18.00 },
  { name: "Glicose Pós Prandial", price: 20.00 },
  { name: "Globulina", price: 20.00 },
  { name: "Gordura Fecal, Pesquisa de", price: 24.00 },
  { name: "Grade Palatina (Fixa)", price: 300.00 },
  { name: "Grade Palatina (Móvel)", price: 340.00 },
  { name: "Grupo Sanguíneo / Fator RH", price: 20.00 },
  { name: "HDL", price: 22.00 },
  { name: "Hemoglobina Glicosilada", price: 62.00 },
  { name: "Hemograma Completo", price: 21.00 },
  { name: "Hepatite A - Anti HAV - IgG", price: 66.00 },
  { name: "Hepatite A - Anti HAV - IgM", price: 71.00 },
  { name: "Hepatite B - Anti HBC - IgC", price: 60.00 },
  { name: "Hepatite B - Anti HBC - IgM", price: 66.00 },
  { name: "Hepatite B - Anti HBS Quantitativo", price: 60.00 },
  { name: "Hepatite B - Anti-HBC Total", price: 60.00 },
  { name: "Hepatite B - HBE-AG", price: 66.00 },
  { name: "Hepatite B - HBS-AG", price: 47.00 },
  { name: "Hepatite B Anti HBE", price: 66.00 },
  { name: "Hepatite C - HCV", price: 134.00 },
  { name: "Hepatite Delta", price: 252.00 },
  { name: "Hormônio do Crescimento - HGH", price: 62.00 },
  { name: "Hormônio Folículo Estimulante - FSH", price: 47.00 },
  { name: "Hormônio Luteinizante - LH", price: 47.00 },
  { name: "HTLV 1 e 2 (Anticorpos)", price: 68.00 },
  { name: "Imobilização Dentária – Esplintagem (Por Segmento)", price: 300.00 },
  { name: "Impedanciometria / Imitanciometria", price: 97.00 },
  { name: "Imunoglobulinas IgA", price: 41.00 },
  { name: "Imunoglobulinas IgE", price: 41.00 },
  { name: "Imunoglobulinas IgG", price: 41.00 },
  { name: "Imunoglobulinas IgM", price: 41.00 },
  { name: "Inlay ou Onlay (Por Elemento)", price: 650.00 },
  { name: "Insulina", price: 24.00 },
  { name: "K (Potássio)", price: 22.00 },
  { name: "Lâmina Direta de Fezes", price: 17.00 },
  { name: "Látex", price: 20.00 },
  { name: "Laudo OIT para Radiografia de Tórax", price: 131.00 },
  { name: "LDL", price: 22.00 },
  { name: "Leucograma", price: 20.00 },
  { name: "Lipase", price: 20.00 },
  { name: "Lipídios Totais", price: 20.00 },
  { name: "Lítio", price: 24.00 },
  { name: "Magnésio - Soro", price: 22.00 },
  { name: "Manganês - Soro", price: 75.00 },
  { name: "Manutenção Ortodôntica (Acompanhamento de Contenção)", price: 90.00 },
  { name: "Manutenção Ortodôntica (Aparelho Fixo - Cerâmico)", price: 144.00 },
  { name: "Manutenção Ortodôntica (Aparelho Fixo - Metal)", price: 90.00 },
  { name: "Manutenção Ortodôntica (Aparelho Fixo - Safira)", price: 144.00 },
  { name: "Manutenção Ortodôntica (Aparelho Móvel)", price: 90.00 },
  { name: "Máscara Facial (Delaire ou Tração Reversa)", price: 334.00 },
  { name: "Mentoneira", price: 334.00 },
  { name: "Mercúrio - Soro", price: 75.00 },
  { name: "Metahemoglobina", price: 28.00 },
  { name: "Micoplasma Hominis", price: 119.00 },
  { name: "Mineralograma", price: 629.00 },
  { name: "Mini-Implante", price: 400.00 },
  { name: "Mononucleose", price: 24.00 },
  { name: "Mucoproteína - Alfa 1 Glicoproteína Ácida", price: 37.00 },
  { name: "Na (Sódio)", price: 22.00 },
  { name: "Níquel Sérico / Sanguíneo / Soro", price: 93.00 },
  { name: "Núcleo Metálico Fundido", price: 250.00 },
  { name: "Parasitológico de Fezes", price: 16.00 },
  { name: "Parasitológico de Fezes (1ª Amostra)", price: 16.00 },
  { name: "Parasitológico de Fezes (2ª Amostra)", price: 16.00 },
  { name: "Parasitológico de Fezes (3ª Amostra)", price: 16.00 },
  { name: "Paratormônio (PTH)", price: 75.00 },
  { name: "PCR - Proteína C Reativa", price: 20.00 },
  { name: "Pesquisa de B.A.A.R.", price: 41.00 },
  { name: "Pesquisa de Bacilo Diftérico", price: 77.00 },
  { name: "Pesquisa de Fungos", price: 41.00 },
  { name: "Pesquisa de Gardenerella", price: 24.00 },
  { name: "Pesquisa de Trichomonas", price: 26.00 },
  { name: "PKU", price: 24.00 },
  { name: "Placa de Hawley", price: 330.00 },
  { name: "Placa de Hawley com Expansor", price: 380.00 },
  { name: "Placa Miorrelaxante", price: 457.00 },
  { name: "Polimento Coronário", price: 80.00 },
  { name: "Profilaxia + Flúor", price: 100.00 },
  { name: "Progesterona", price: 62.00 },
  { name: "Prolactina", price: 50.00 },
  { name: "Proteína C", price: 199.00 },
  { name: "Proteína de Bence Jones", price: 24.00 },
  { name: "Proteína S", price: 233.00 },
  { name: "Proteína Total", price: 20.00 },
  { name: "Prótese Fixa Adesiva Direta (1 Elemento)", price: 500.00 },
  { name: "Prótese Fixa Adesiva Indireta (1 Elemento)", price: 1100.00 },
  { name: "Prótese Fixa Adesiva Indireta (2 Elementos)", price: 1650.00 },
  { name: "Prótese Parcial Fixa (Cerâmica Pura)", price: 1160.00 },
  { name: "Prótese Parcial Removível (Provisória)", price: 900.00 },
  { name: "Prótese Parcial Removível com Grampos", price: 1250.00 },
  { name: "Prótese Total", price: 1200.00 },
  { name: "Protoporfirina Zinco", price: 102.00 },
  { name: "PSA Livre e Total", price: 96.00 },
  { name: "PSA Total", price: 66.00 },
  { name: "Pulpectomia", price: 250.00 },
  { name: "Pulpotomia", price: 180.00 },
  { name: "Quadrihélice", price: 350.00 },
  { name: "Radiografia Abdômen Simples", price: 61.00 },
  { name: "Radiografia Antebraço", price: 71.00 },
  { name: "Radiografia Articulação Coxo Femural", price: 72.00 },
  { name: "Radiografia Articulação Têmporo Mandibular (ATM)", price: 96.00 },
  { name: "Radiografia Bacia", price: 72.00 },
  { name: "Radiografia Braço", price: 71.00 },
  { name: "Radiografia Calcâneo PA + Perfil", price: 71.00 },
  { name: "Radiografia Cavum (Seios da Face)", price: 61.00 },
  { name: "Radiografia Coluna Cervical PA + Perfil", price: 72.00 },
  { name: "Radiografia Coluna Cervical PA + Perfil + Oblíqua", price: 120.00 },
  { name: "Radiografia Coluna Dorsal PA + Perfil", price: 72.00 },
  { name: "Radiografia Coluna Lombar PA + Perfil", price: 72.00 },
  { name: "Radiografia Coluna Lombo Sacra PA + Perfil", price: 72.00 },
  { name: "Radiografia Coluna Toraco Lombar PA + Perfil", price: 120.00 },
  { name: "Radiografia Coluna Vertebral PA + Perfil (Total)", price: 226.00 },
  { name: "Radiografia Cotovelo", price: 61.00 },
  { name: "Radiografia Coxa", price: 85.00 },
  { name: "Radiografia Crânio", price: 71.00 },
  { name: "Radiografia Crânio PA + Perfil + Oblíqua + Hirtz", price: 92.00 },
  { name: "Radiografia Joelho", price: 71.00 },
  { name: "Radiografia Joelho PA + Perfil + Axial", price: 80.00 },
  { name: "Radiografia Mão PA + Perfil", price: 71.00 },
  { name: "Radiografia Ombro", price: 71.00 },
  { name: "Radiografia Ombro PA + Axial + Omoplata", price: 85.00 },
  { name: "Radiografia Pata de Rã", price: 72.00 },
  { name: "Radiografia Pé PA + Oblíqua", price: 71.00 },
  { name: "Radiografia Periodontal (Por Tomada Radiográfica)", price: 40.00 },
  { name: "Radiografia Perna PA + Perfil", price: 71.00 },
  { name: "Radiografia Punho PA + Perfil", price: 71.00 },
  { name: "Radiografia Seios da Face Frontal + Mento-Nasal", price: 71.00 },
  { name: "Radiografia Seios da Face Frontal + Mento-Nasal + Perfil", price: 61.00 },
  { name: "Radiografia Tórax PA", price: 120.00 },
  { name: "Radiografia Tórax PA + Perfil + Oblíqua", price: 157.00 },
  { name: "Radiografia Tórax PA com Laudo OIT", price: 80.00 },
  { name: "Radiografia Tórax PA e Perfil", price: 71.00 },
  { name: "Radiografia Tornozelo PA + Perfil", price: 85.00 },
  { name: "Raspagem Sub-Gengival (Por Arcada)", price: 150.00 },
  { name: "Raspagem Supra-Gengival (Por Arcada)", price: 80.00 },
  { name: "Reação de Widal (Febre Tifóide)", price: 28.00 },
  { name: "Relação A/G", price: 20.00 },
  { name: "Remineralização", price: 120.00 },
  { name: "Remoção de Cerume", price: 152.00 },
  { name: "Remoção de Núcleo Metálico", price: 350.00 },
  { name: "Reposição e Colagem de Bráquetes (Cerâmico)", price: 20.00 },
  { name: "Reposição e Colagem de Bráquetes (Metal)", price: 10.00 },
  { name: "Reposição e Colagem de Bráquetes (Safira)", price: 30.00 },
  { name: "Restauração Anterior em Resina Fotopolimerizável 1/3 da Coroa", price: 180.00 },
  { name: "Restauração com Pino de Retenção", price: 270.00 },
  { name: "Restauração em Amálgama (1 Face)", price: 90.00 },
  { name: "Restauração em Amálgama (2 Faces)", price: 97.00 },
  { name: "Restauração em Amálgama (3 Faces)", price: 110.00 },
  { name: "Restauração em Resina Fotopolimerizável (1 Face)", price: 87.00 },
  { name: "Restauração em Resina Fotopolimerizável (2 Faces)", price: 93.00 },
  { name: "Restauração em Resina Fotopolimerizável (3 Faces)", price: 101.00 },
  { name: "Restauração Estética em Resina Fotopolimerizável (Dentes Posteriores)", price: 179.00 },
  { name: "Restauração Provisória (Tratamento Expectante)", price: 65.00 },
  { name: "Reticulócitos", price: 20.00 },
  { name: "Retratamento Endodôntico (Incisivo a Canino)", price: 660.00 },
  { name: "Retratamento Endodôntico (Molar)", price: 930.00 },
  { name: "Retratamento Endodôntico (Pré-Molar)", price: 790.00 },
  { name: "Rubéola IgG", price: 47.00 },
  { name: "Rubéola IgM", price: 72.00 },
  { name: "Sangue Oculto, Pesquisa de", price: 22.00 },
  { name: "Seringa de Ácido para Clareamento (Unidade)", price: 120.00 },
  { name: "Sorologia Imunofluorescência Schistossomose", price: 47.00 },
  { name: "Sulfato de Deidroepiandrosferona", price: 68.00 },
  { name: "Sumário de Urina", price: 20.00 },
  { name: "T3 Livre", price: 51.00 },
  { name: "T3-Triiiodotironina", price: 37.00 },
  { name: "T4-Livre-Tiroxina Livre", price: 41.00 },
  { name: "T4-Tiroxina Total", price: 28.00 },
  { name: "TC - Tempo de Coagulação", price: 20.00 },
  { name: "Teleconsulta Médica", price: 58.00 },
  { name: "Teleconsulta Nutricionista", price: 40.00 },
  { name: "Teleconsulta Psicólogo", price: 44.00 },
  { name: "Tempo de Tromboplastina Parcial Ativado", price: 20.00 },
  { name: "Teste Ergométrico", price: 175.00 },
  { name: "Teste Luético", price: 20.00 },
  { name: "Testosterona Livre", price: 53.00 },
  { name: "Testosterona Total", price: 68.00 },
  { name: "TGO - Transaminase Oxaloacética", price: 17.00 },
  { name: "TGP - Transaminase Pirúvica", price: 17.00 },
  { name: "Tireoglobulina", price: 88.00 },
  { name: "Tolueno Sérico", price: 233.00 },
  { name: "Toxicológico de Larga Janela de Detecção", price: 150.00 },
  { name: "Toxoplasmose IgM", price: 62.00 },
  { name: "Toxoplasmose IgG", price: 60.00 },
  { name: "TP/AE", price: 20.00 },
  { name: "Transferrina", price: 47.00 },
  { name: "Tratamento de Abscesso Periodontal Agudo", price: 90.00 },
  { name: "Tratamento Endodôntico (Incisivo a Canino)", price: 520.00 },
  { name: "Tratamento Endodôntico (Molar)", price: 790.00 },
  { name: "Tratamento Endodôntico (Pré-Molar)", price: 660.00 },
  { name: "Tratamento Periodontal (3 Consultas de Acompanhamento)", price: 400.00 },
  { name: "Triglicérides", price: 20.00 },
  { name: "TS - Tempo de Sangramento", price: 20.00 },
  { name: "TSH-Ultra Sensível", price: 41.00 },
  { name: "Ulectomia", price: 180.00 },
  { name: "Ulotomia", price: 120.00 },
  { name: "Ultrassonografia Abdômen Superior", price: 122.00 },
  { name: "Ultrassonografia Abdômen Total", price: 202.00 },
  { name: "Ultrassonografia Axila", price: 134.00 },
  { name: "Ultrassonografia Bolsa Escrotal", price: 166.00 },
  { name: "Ultrassonografia Mamária", price: 141.00 },
  { name: "Ultrassonografia Obstétrica", price: 138.00 },
  { name: "Ultrassonografia Parede Abdominal", price: 160.00 },
  { name: "Ultrassonografia Partes Moles (Couro Cabeludo)", price: 127.00 },
  { name: "Ultrassonografia Partes Moles (Membros Superiores e Inferiores)", price: 127.00 },
  { name: "Ultrassonografia Partes Moles (Região Cervical)", price: 127.00 },
  { name: "Ultrassonografia Partes Moles (Região Dorsal)", price: 127.00 },
  { name: "Ultrassonografia Partes Moles (Região Inframandibular)", price: 127.00 },
  { name: "Ultrassonografia Partes Moles (Região Lombar)", price: 127.00 },
  { name: "Ultrassonografia Partes Moles (Torax)", price: 127.00 },
  { name: "Ultrassonografia Pélvica", price: 127.00 },
  { name: "Ultrassonografia Próstata", price: 127.00 },
  { name: "Ultrassonografia Região Inguinal", price: 127.00 },
  { name: "Ultrassonografia Renal", price: 127.00 },
  { name: "Ultrassonografia Tireóide", price: 126.00 },
  { name: "Ultrassonografia Transretal", price: 126.00 },
  { name: "Ultrassonografia Transvaginal", price: 126.00 },
  { name: "Ureaplasma Urealyticum", price: 119.00 },
  { name: "Uréia", price: 20.00 },
  { name: "Urocultura", price: 50.00 },
  { name: "Vitamina B 12", price: 66.00 },
  { name: "Vitamina D – 1,25 Dhidroxi", price: 110.00 },
  { name: "Vitamina D – Hidroxi em Soro", price: 93.00 },
  { name: "VLDL", price: 20.00 },
  { name: "VSH", price: 17.00 },
  { name: "Waller Rose", price: 22.00 },
  { name: "Zika Virus-Sorologia Total - IgG", price: 254.00 },
  { name: "Zika Virus-Sorologia Total - IgM", price: 281.00 }
    ];

    let db;
    let selectedExams = [];

    async function initDatabase() {
      try {
        const sql = await initSqlJs({ locateFile: file => 'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.wasm' });
        db = new sql.Database();
        db.run(`
          CREATE TABLE IF NOT EXISTS exams (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL UNIQUE,
            price REAL NOT NULL
          );
        `);

        const count = db.exec("SELECT COUNT(*) AS count FROM exams")[0].values[0][0];
        if (count === 0 && initialExams && initialExams.length > 0) {
          const stmt = db.prepare("INSERT INTO exams (name, price) VALUES (?, ?)");
          initialExams.forEach(exam => {
            stmt.run([exam.name, exam.price]);
          });
          stmt.free();
        }
      } catch (error) {
        console.error('Erro ao inicializar o banco de dados:', error);
        alert('Falha ao carregar o sistema. Verifique sua conexão com a internet ou tente outro navegador.');
        return null;
      }
    }

    function getExams(filterText = '') {
      try {
        let query = "SELECT name, price FROM exams";
        let params = [];
        let exams = [];

        const stmt = db.prepare(query);
        while (stmt.step()) {
          const row = stmt.getAsObject();
          exams.push({ name: row.name, price: parseFloat(row.price) });
        }
        stmt.free();

        if (filterText) {
          const normalizedFilter = normalizeString(filterText);
          exams = exams.filter(exam => 
            normalizeString(exam.name).includes(normalizedFilter)
          );
        }

        exams.sort((a, b) => a.name.localeCompare(b.name, 'pt', { sensitivity: 'base' }));
        return exams;
      } catch (error) {
        console.error('Erro ao buscar exames:', error);
        return [];
      }
    }

    function normalizeString(str) {
      return str
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/[-_]/g, '')
        .toLowerCase();
    }

    function renderExamCheckboxes(filterText = '') {
      const examListContainer = document.querySelector('#examListContainer');
      examListContainer.innerHTML = '';
      const filteredExams = getExams(filterText);
      const fragment = document.createDocumentFragment();

      if (filteredExams.length === 0 && filterText) {
        const div = document.createElement('div');
        div.className = 'no-results';
        div.textContent = 'Nenhum exame encontrado';
        fragment.appendChild(div);
      } else {
        filteredExams.forEach(exam => {
          const div = document.createElement('div');
          div.className = 'exam-checkbox';
          const isChecked = selectedExams.some(selected => selected.name === exam.name);
          div.innerHTML = `
            <input type="checkbox" id="exam-${escapeHTML(exam.name)}" value="${escapeHTML(exam.name)}" ${isChecked ? 'checked' : ''} aria-label="Selecionar exame ${escapeHTML(exam.name)}">
            <label for="exam-${escapeHTML(exam.name)}">${escapeHTML(exam.name)} <span>(R$ ${exam.price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })})</span></label>
          `;
          fragment.appendChild(div);
        });
      }
      examListContainer.appendChild(fragment);
      examListContainer.style.display = filterText ? 'block' : 'none';

      document.querySelectorAll('.exam-checkbox input').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          const examName = checkbox.value;
          const exam = filteredExams.find(e => e.name === examName);
          if (checkbox.checked) {
            if (!selectedExams.some(selected => selected.name === examName)) {
              selectedExams.push({ name: examName, price: exam.price });
            }
          } else {
            selectedExams = selectedExams.filter(selected => selected.name !== examName);
          }
          renderSelectedExams();
        });
      });
    }

    function renderSelectedExams() {
      const tableBody = document.getElementById('selectedExamTable');
      tableBody.innerHTML = '';
      const fragment = document.createDocumentFragment();
      selectedExams.forEach((exam, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td data-label="Exame">${escapeHTML(exam.name)}</td>
          <td data-label="Preço">R$ ${exam.price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td data-label="Ação" class="action-cell">
            <button class="delete-exam-btn" data-index="${index}" aria-label="Excluir exame ${escapeHTML(exam.name)}">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        fragment.appendChild(row);
      });
      tableBody.appendChild(fragment);

      document.querySelectorAll('.delete-exam-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const index = parseInt(e.target.closest('button').dataset.index);
          selectedExams.splice(index, 1);
          renderSelectedExams();
          renderExamCheckboxes(document.querySelector('#examSearch').value);
        });
      });

      updateTotal();
    }

    function renderPriceManagementList() {
      const examListItems = document.querySelector('#examList');
      examListItems.innerHTML = '';
      const exams = getExams();
      const fragment = document.createDocumentFragment();
      exams.forEach((exam, index) => {
        const div = document.createElement('div');
        div.className = 'exam-item';
        div.innerHTML = `
          <span>${escapeHTML(exam.name)} - R$ ${exam.price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
          <div>
            <button class="edit-price" data-name="${escapeHTML(exam.name)}" aria-label="Editar preço do exame ${escapeHTML(exam.name)}"><i class="fas fa-edit"></i></button>
            <button class="delete-exam" data-name="${escapeHTML(exam.name)}" aria-label="Excluir exame ${escapeHTML(exam.name)}"><i class="fas fa-trash"></i></button>
          </div>
        `;
        fragment.appendChild(div);
      });
      examListItems.appendChild(fragment);

      document.querySelectorAll('.edit-price').forEach(button => {
        button.addEventListener('click', (e) => {
          const name = e.target.closest('button').dataset.name;
          const newPrice = prompt('Digite o novo preço:', exams.find(exam => exam.name === name).price);
          if (newPrice && !isNaN(newPrice) && newPrice > 0) {
            try {
              const stmt = db.prepare("UPDATE exams SET price = ? WHERE name = ?");
              stmt.run([parseFloat(newPrice), name]);
              stmt.free();
              renderPriceManagementList();
              renderExamCheckboxes(document.querySelector('#examSearch').value);
              selectedExams = selectedExams.map(exam => 
                exam.name === name ? { ...exam, price: parseFloat(newPrice) } : exam
              );
              renderSelectedExams();
            } catch (error) {
              console.error('Erro ao atualizar preço:', error);
              alert('Falha ao atualizar o preço do exame.');
            }
          }
        });
      });

      document.querySelectorAll('.delete-exam').forEach(button => {
        button.addEventListener('click', (e) => {
          const name = e.target.closest('button').dataset.name;
          if (confirm(`Deseja excluir o exame "${name}"?`)) {
            try {
              const stmt = db.prepare("DELETE FROM exams WHERE name = ?");
              stmt.run([name]);
              stmt.free();
              renderPriceManagementList();
              renderExamCheckboxes(document.querySelector('#examSearch').value);
              selectedExams = selectedExams.filter(exam => exam.name !== name);
              renderSelectedExams();
            } catch (error) {
              console.error('Erro ao excluir exame:', error);
              alert('Falha ao excluir o exame.');
            }
          }
        });
      });
    }

    function formatDate(dateStr) {
      if (!dateStr) return 'Não informado';
      const [year, month, day] = dateStr.split('-').map(Number);
      const date = new Date(year, month - 1, day);
      if (isNaN(date.getTime())) return 'Não informado';
      return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }

    function validateCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;

      let sum = 0;
      for (let i = 0; i < 9; i++) sum += parseInt(cpf[i]) * (10 - i);
      let digit1 = 11 - (sum % 11);
      if (digit1 > 9) digit1 = 0;
      if (parseInt(cpf[9]) !== digit1) return false;

      sum = 0;
      for (let i = 0; i < 10; i++) sum += parseInt(cpf[i]) * (11 - i);
      let digit2 = 11 - (sum % 11);
      if (digit2 > 9) digit2 = 0;
      return parseInt(cpf[10]) === digit2;
    }

    function validatePromoDates() {
      const startDateInput = document.querySelector('#promoStartDate');
      const endDateInput = document.querySelector('#promoEndDate');
      const startDateError = document.querySelector('#promoStartDateError');
      const endDateError = document.querySelector('#promoEndDateError');

      startDateError.style.display = 'none';
      endDateError.style.display = 'none';

      if (!startDateInput.value) {
        startDateInput.classList.add('error');
        startDateError.style.display = 'block';
        return false;
      }
      startDateInput.classList.remove('error');

      if (endDateInput.value && startDateInput.value) {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        if (endDate < startDate) {
          endDateInput.classList.add('error');
          endDateError.style.display = 'block';
          return false;
        }
        endDateInput.classList.remove('error');
      }
      return true;
    }

    function validateDiscountInput(inputId, errorId) {
      const input = document.querySelector(`#${inputId}`);
      const inputError = document.querySelector(`#${errorId}`);
      const value = parseFloat(input.value);
      if (isNaN(value) || value < 0 || (inputId === 'discountInput' && value > 70) || (inputId === 'promoDiscountInput' && value > 25)) {
        input.classList.add('error');
        inputError.style.display = 'block';
        return false;
      } else {
        input.classList.remove('error');
        inputError.style.display = 'none';
        return true;
      }
    }

    function validatePhone() {
      const phoneInput = document.getElementById('telefoneInput');
      const phoneError = document.querySelector('#phoneError');
      const phonePattern = /^\d{10,11}$/;
      if (!phonePattern.test(phoneInput.value) && phoneInput.value !== '') {
        phoneInput.classList.add('error');
        phoneError.style.display = 'block';
        return false;
      } else {
        phoneInput.classList.remove('error');
        phoneError.style.display = 'none';
        return true;
      }
    }

    function clearSelections() {
      selectedExams = [];
      document.getElementById('examSearch').value = '';
      document.getElementById('discountInput').value = '';
      document.getElementById('promoDiscountInput').value = '';
      document.getElementById('enableIndustryDiscount').checked = false;
      document.getElementById('enablePromoDiscount').checked = false;
      document.getElementById('promoType').value = '';
      document.getElementById('promoStartDate').value = '';
      document.getElementById('promoEndDate').value = '';
      document.getElementById('otherPromoInput').value = '';
      document.getElementById('discountInput').disabled = true;
      document.getElementById('promoDiscountInput').disabled = true;
      document.getElementById('promoType').disabled = true;
      document.getElementById('promoStartDate').disabled = true;
      document.getElementById('promoEndDate').disabled = true;
      document.getElementById('otherPromoContainer').style.display = 'none';
      document.getElementById('promoDetails').classList.remove('active');
      document.getElementById('discountSection').classList.remove('active');
      document.getElementById('Input').value = '';
      document.getElementById('telefoneInput').value = '';
      document.getElementById('cpfInput').value = '';
      document.querySelector('#printType').value = 'standard';
      document.getElementById('totalPrice').textContent = '0,00';
      document.getElementById('discountPercent').textContent = '0';
      document.getElementById('discountValue').textContent = '0,00';
      document.getElementById('promoDiscountPercent').textContent = '0';
      document.getElementById('promoDiscountValue').textContent = '0,00';
      document.getElementById('finalPrice').textContent = '0,00';
      document.getElementById('promoStartDateError').style.display = 'none';
      document.getElementById('promoEndDateError').style.display = 'none';
      document.getElementById('promoStartDate').classList.remove('error');
      document.getElementById('promoEndDate').classList.remove('error');
      document.getElementById('discountInputError').style.display = 'none';
      document.getElementById('promoDiscountInputError').style.display = 'none';
      document.getElementById('discountInput').classList.remove('error');
      document.getElementById('promoDiscountInput').classList.remove('error');
      document.getElementById('cpfError').style.display = 'none';
      document.getElementById('cpfInput').classList.remove('error');
      renderSelectedExams();
      renderExamCheckboxes();
    }

    function updateTotal() {
      let total = selectedExams.reduce((sum, exam) => sum + exam.price, 0);
      let discountPercent = document.getElementById('enableIndustryDiscount').checked ? (parseFloat(document.getElementById('discountInput').value) || 0) : 0;
      let promoDiscountPercent = document.getElementById('enablePromoDiscount').checked ? (parseFloat(document.getElementById('promoDiscountInput').value) || 0) : 0;
      discountPercent = Math.max(0, Math.min(70, discountPercent));
      promoDiscountPercent = Math.max(0, Math.min(25, promoDiscountPercent));
      const discountValue = total * (discountPercent / 100);
      const intermediateTotal = Math.max(total - discountValue, 0);
      const promoDiscountValue = intermediateTotal * (promoDiscountPercent / 100);
      const finalPrice = Math.max(intermediateTotal - promoDiscountValue, 0);
      document.getElementById('totalPrice').textContent = total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      document.getElementById('discountPercent').textContent = discountPercent.toFixed(2);
      document.getElementById('discountValue').textContent = discountValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      document.getElementById('promoDiscountPercent').textContent = promoDiscountPercent.toFixed(2);
      document.getElementById('promoDiscountValue').textContent = promoDiscountValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      document.getElementById('finalPrice').textContent = finalPrice.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function applyDiscount() {
      if (validateDiscountInput('discountInput', 'discountInputError')) {
        updateTotal();
      }
    }

    function applyPromoDiscount() {
      if (validateDiscountInput('promoDiscountInput', 'promoDiscountInputError') && validatePromoDates()) {
        updateTotal();
      }
    }

function escapeHTML(str) {
  const htmlEntities = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  };
  return str.replace(/[&<>"']/g, match => htmlEntities[match]);
}

    function saveChanges() {
      alert('Alterações salvas com sucesso no banco de dados!');
    }

    function printSummary() {
      const cpfInput = document.getElementById('cpfInput').value;
      if (cpfInput && !validateCPF(cpfInput)) {
        document.getElementById('cpfError').style.display = 'block';
        document.getElementById('cpfInput').classList.add('error');
        return;
      } else {
        document.getElementById('cpfError').style.display = 'none';
        document.getElementById('cpfInput').classList.remove('error');
      }

      if (selectedExams.length === 0) {
        alert('Selecione pelo menos um exame antes de imprimir.');
        return;
      }
      if (!validatePhone() && document.getElementById('telefoneInput').value !== '') {
        alert('Corrija o número de telefone antes de imprimir.');
        return;
      }
      if (document.getElementById('enablePromoDiscount').checked && !validatePromoDates()) {
        alert('Corrija as datas promocionais antes de imprimir.');
        return;
      }

      const total = parseFloat(document.getElementById('totalPrice').textContent.replace(/\./g, '').replace(',', '.'));
      const discountPercent = parseFloat(document.getElementById('discountPercent').textContent);
      const discountValue = parseFloat(document.getElementById('discountValue').textContent.replace(/\./g, '').replace(',', '.'));
      const promoDiscountPercent = parseFloat(document.getElementById('promoDiscountPercent').textContent);
      const promoDiscountValue = parseFloat(document.getElementById('promoDiscountValue').textContent.replace(/\./g, '').replace(',', '.'));
      const finalPrice = parseFloat(document.getElementById('finalPrice').textContent.replace(/\./g, '').replace(',', '.'));
      const responsible = escapeHTML(document.getElementById('responsibleInput').value || 'Não informado');
      const  = escapeHTML(document.getElementById('Input').value || 'Não informado');
      const telefone = escapeHTML(document.getElementById('telefoneInput').value || 'Não informado');
      const promoTypeValue = document.getElementById('promoType').value;
      const promoType = promoTypeValue === 'Outros' ? escapeHTML(document.getElementById('otherPromoInput').value || 'Não informado') : escapeHTML(promoTypeValue || 'Não informado');
      const promoStartDateRaw = document.getElementById('promoStartDate').value;
      const promoEndDateRaw = document.getElementById('promoEndDate').value;
      const promoStartDate = formatDate(promoStartDateRaw);
      const promoEndDate = formatDate(promoEndDateRaw);
      const isIndustryDiscountApplied = document.getElementById('enableIndustryDiscount').checked && discountPercent > 0;
      const isPromoDiscountApplied = document.getElementById('enablePromoDiscount').checked && promoDiscountPercent > 0;
      const currentYear = new Date().getFullYear();
      const isPromoValid = isPromoDiscountApplied &&
                           promoStartDate !== 'Não informado' &&
                           promoEndDate !== 'Não informado' &&
                           new Date(promoEndDateRaw) >= new Date(promoStartDateRaw);
      const printType = document.getElementById('printType').value;

      let printContent;

      if (printType === 'thermal') {
        printContent = `
          <html>
          <head>
            <title>Resumo de Exames</title>
            <style>
              @page {
                margin: 0;
              }
              body {
                font-family: monospace;
                font-size: 10pt;
                margin: 0;
                padding: 0 5mm 5mm 0;
                width: 80mm;
                line-height: 1.2;
                color: #000;
                background: #fff;
                text-align: left;
              }
              .line { margin-bottom: 0.3em; }
              .divider { border-top: 1px dashed #000; margin: 0.5em 0; }
              .center { text-align: center; }
              .bold { font-weight: bold; }
              .warning {
                margin: 0.5em 0;
                font-size: 9pt;
                text-align: center;
              }
              .warning-title { font-weight: bold; text-align: center; }
            </style>
          </head>
          <body>
            <div class="center bold">
              <p>SERVIÇO SOCIAL DA INDÚSTRIA</p>
              <p>CNPJ: 03.910.210/0025-82</p>
              <p>ORÇAMENTO DE EXAMES</p>
            </div>
            <div class="divider"></div>
            <div class="line">Gerado em: ${new Date().toLocaleString('pt-BR')}</div>
            <div class="line">Responsável pelo Orçamento: ${responsible}</div>
            <div class="line">: ${}</div>
            <div class="line">Telefone do Solicitante: ${telefone}</div>
            ${cpfInput ? `<div class="line">CPF do Solicitante: ${cpfInput}</div>` : ''}
            <div class="divider"></div>
            <div class="center bold">Exames Selecionados</div>
            ${selectedExams.length === 0 ? `
              <div class="line center">Nenhum exame selecionado</div>
            ` : selectedExams.map(exam => `
              <div class="line">${exam.name.substring(0, 40)}</div>
              <div class="price">R$ ${exam.price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            `).join('')}
            <div class="divider"></div>
            <div class="line">Valor Total: R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            ${isIndustryDiscountApplied ? `
              <div class="line">Desconto Indústria: R$ ${discountValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            ` : ''}
            ${isPromoDiscountApplied ? `
              <div class="line">Desconto Promocional: R$ ${promoDiscountValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            ` : ''}
            <div class="line bold">Total do Pagamento: R$ ${finalPrice.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            ${isPromoDiscountApplied ? `
              <div class="divider"></div>
              <div class="line">Promoção: ${promoType}</div>
              ${isPromoValid ? `
                <div class="line">Vigência: ${promoStartDate} a ${promoEndDate}</div>
              ` : `
                <div class="line">Promoção: Datas inválidas. Verifique.</div>
              `}
            ` : ''}
            <div class="divider"></div>
            <div class="warning">
              <div class="warning-title">AVISO IMPORTANTE</div>
              <div class="line"><p>Ao solicitar este orçamento, o  autoriza o uso de dados pessoais (nome, telefone, CPF) para esta finalidade.</p>
                                <p>Este orçamento possui validade a partir da data de sua emissão, até o término do ano corrente (${currentYear}). Nesse período, os valores poderão ser atualizados, inclusive em decorrência de campanhas promocionais ou ajustes de tabela. Caso o agendamento do serviço ocorra fora do prazo de validade ou durante a vigência de novas condições comerciais, o  será previamente informado sobre eventuais alterações nos preços antes da confirmação do atendimento.</p></div>
              <div class="line"> </div>
              ${isPromoValid ? `
                <div class="line">Promoção válida de ${promoStartDate} a ${promoEndDate}.</div>
              ` : ''}
            </div>
            <div class="divider"></div>
            <div class="line">Endereço: Rua Frei Cassiano, 88</div>
            <div class="line">Santo Amaro, Recife - PE</div>
            <div class="line">Data: ${new Date().toLocaleString('pt-BR')}</div>
          </body>
          </html>
        `;
      } else {
        printContent = `
          <html>
          <head>
            <title>Resumo de Exames</title>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
            <style>
              @media print { .no-print { display: none; } @page { margin: 2cm; } .btn-primary { display: none; } }
              body { font-family: 'Inter', sans-serif; color: #111827; background: white; margin: 0; padding: 2rem; }
              .print-container { max-width: 800px; margin: 0 auto; padding: 1.5rem; border: 1px solid #e5e7eb; border-radius: 0.75rem; background: #ffffff; }
              .print-header { margin-bottom: 2rem; border-bottom: 2px solid #2563eb; padding-bottom: 1rem; }
              .print-header .header-container { display: flex; align-items: center; justify-content: space-between; }
              .print-header .logo-container img { max-width: 120px; height: auto; }
              .print-header .title-container { flex: 1; text-align: center; }
              .print-header h1 { font-size: 1.5rem; color: #111827; margin: 0; }
              .print-header p { color: #555; font-size: 0.875rem; margin: 0.5rem 0; }
              .print-exams-section { margin-bottom: 2rem; }
              .print-exams-section h2 { font-size: 1.25rem; margin-bottom: 1rem; text-align: center; color: #2563eb; }
              .print-table { width: 100%; border-collapse: collapse; }
              .print-table th { background: #2563eb; color: white; padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.875rem; }
              .print-table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem; }
              .print-table tr:hover { background: #f3f4f6; }
              .print-summary { background: #f0f7ff; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem; }
              .print-summary p { display: flex; align-items: center; gap: 0.5rem; font-size: 1rem; margin: 0.5rem 0; }
              .print-summary .final-price { font-size: 1.25rem; font-weight: 600; color: #2563eb; }
              .print-warning { background: #fef2f2; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border: 1px solid #ef4444; color: #111827; font-size: 0.875rem; }
              .print-warning i { margin-right: 0.5rem; color: #ef4444; }
              .print-footer { text-align: center; color: #555; font-size: 0.875rem; margin-top: 2rem; border-top: 1px solid #e5e7eb; padding-top: 1rem; }
              @media (max-width: 640px) {
                .print-table { display: block; }
                .print-table thead { display: none; }
                .print-table tbody, .print-table tr { display: block; }
                .print-table td { display: block; text-align: left; padding: 0.5rem; border-bottom: none; }
                .print-table td:before { content: attr(data-label); font-weight: bold; display: inline-block; width: 100%; margin-bottom: 0.2rem; }
              }
            </style>
          </head>
          <body>
            <div class="print-container">
              <div class="print-header">
                <div class="header-container">
                  <div class="logo-container">
                    <img src="img/sesi.jpg" alt="SESI Logo">
                  </div>
                  <div class="title-container">
                    <h1>Orçamento de Exames e Especialidades</h1>
                  </div>
                  <div class="logo-container">
                    <img src="img/melhoria.jpg" alt="Melhoria Logo">
                  </div>
                </div>
                <p>Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                <p>Responsável pelo Orçamento: ${responsible}</p>
                <p>Solicitante: ${solicitante} ${cpfInput ? `(CPF do Solicitante: ${cpfInput})` : ''}</p>
                <p>Telefone do Solicitante: ${telefone}</p>
              </div>
              <div class="print-exams-section">
                <h2>Exames Selecionados</h2>
                <table class="print-table">
                  <thead>
                    <tr>
                      <th>Exame</th>
                      <th>R$</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${selectedExams.length === 0 ? `
                      <tr>
                        <td colspan="2" style="text-align: center; color: #6b7280;">Nenhum exame selecionado</td>
                      </tr>
                    ` : selectedExams.map(exam => `
                      <tr>
                        <td data-label="Exame">${escapeHTML(exam.name)}</td>
                        <td data-label="Preço">R$ ${exam.price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
              <div class="print-summary">
                <p><i class="fas fa-money-bill-wave"></i> Valor Total: R$ <span>${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span></p>
                ${isIndustryDiscountApplied ? `<p><i class="fas fa-percentage"></i> Desconto Indústria: R$ <span>${discountValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span> (<span>${discountPercent.toFixed(2)}</span>%)</p>` : ''}
                ${isPromoDiscountApplied ? `<p><i class="fas fa-star"></i> Desconto Promocional: R$ <span>${promoDiscountValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span> (<span>${promoDiscountPercent.toFixed(2)}</span>%)</p>` : ''}
                <p class="final-price"><i class="fas fa-wallet"></i> Total do Pagamento: R$ <span>${finalPrice.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span></p>
                ${isPromoDiscountApplied ? `
                  <p><i class="fas fa-tag"></i> Tipo de Promoção: <span>${promoType}</span></p>
                  ${isPromoValid ? `
                    <p><i class="fas fa-calendar-alt"></i> Início da Promoção: <span>${promoStartDate}</span></p>
                    <p><i class="fas fa-calendar-alt"></i> Término da Promoção: <span>${promoEndDate}</span></p>
                    <p><i class="fas fa-info-circle"></i> Vigência da Promoção: <span>Os descontos promocionais são válidos apenas dentro do período especificado (${promoStartDate} a ${promoEndDate}).</span></p>
                  ` : `
                    <p><i class="fas fa-exclamation-circle"></i> Promoção: <span>Datas de promoção inválidas ou não informadas. O desconto promocional será aplicado, mas verifique as datas.</span></p>
                  `}
                ` : ''}
              </div>
              <div class="print-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>AVISO IMPORTANTE</strong><br>
                <p>Ao solicitar o orçamento de exames laboratoriais e especialidades médicas, o  declara expressamente que autoriza o tratamento dos dados pessoais de nome, telefone e CPF, para essa finalidade específica.</p>
                <p>Este orçamento possui validade a partir da data de sua emissão, até o término do ano corrente (${currentYear}). Nesse período, os valores poderão ser atualizados, inclusive em decorrência de campanhas promocionais ou ajustes de tabela. Caso o agendamento do serviço ocorra fora do prazo de validade ou durante a vigência de novas condições comerciais, o  será previamente informado sobre eventuais alterações nos preços antes da confirmação do atendimento.</p>
              </div>
              <div class="print-footer">
                <p>Endereço: <a href="https://www.google.com/maps/place/Rua+Frei+Cassimiro,+88,+Santo+Amaro,+Recife,+PE,+50100-260" target="_blank">Rua Frei Cassimiro, 88 - Santo Amaro, Recife - PE, 50100-260</a></p>
                <p>Data: ${new Date().toLocaleString('pt-BR')}</p>
              </div>
              <button id="printButtonWindow" class="btn-primary no-print"><i class="fas fa-print mr-2"></i> Imprimir</button>
            </div>
          </body>
          </html>
        `;
      }

      const printWindow = window.open('', '_blank');
      if (!printWindow) {
        alert('Não foi possível abrir a janela de impressão. Verifique as configurações de pop-ups do seu navegador.');
        return;
      }
      printWindow.document.write(printContent);
      printWindow.document.close();
      printWindow.document.getElementById('printButtonWindow')?.addEventListener('click', () => printWindow.print());
    }

    function handleLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const loginError = document.getElementById('loginError');

      if (username === 'SESI' && password === 'sistema@2025') {
        loginError.style.display = 'none';
        document.getElementById('priceManagement').classList.add('active');
        document.querySelector('.modal-content .form-group').style.display = 'none';
        document.querySelector('.modal-content .button-container').style.display = 'none';
        document.querySelector('.modal-content h2').textContent = 'Gerenciamento de Preços';
        renderPriceManagementList();
      } else {
        loginError.style.display = 'block';
      }
    }

    function handleAddExam() {
      const name = document.getElementById('newExamName').value.trim();
      const price = parseFloat(document.getElementById('newExamPrice').value);
      if (name && !isNaN(price) && price > 0) {
        try {
          const stmt = db.prepare("INSERT INTO exams (name, price) VALUES (?, ?)");
          stmt.run([name, price]);
          stmt.free();
          document.getElementById('newExamName').value = '';
          document.getElementById('newExamPrice').value = '';
          renderPriceManagementList();
          renderExamCheckboxes(document.querySelector('#examSearch').value);
        } catch (error) {
          console.error('Erro ao adicionar exame:', error);
          alert('Falha ao adicionar o exame. Verifique se o nome já existe.');
        }
      } else {
        alert('Por favor, insira um nome válido e um preço maior que zero.');
      }
    }

    function handleExcelUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false });

            if (jsonData.length < 1 || !jsonData[0].includes('name') || !jsonData[0].includes('price')) {
              throw new Error('Formato inválido: o arquivo deve conter as colunas "name" e "price".');
            }

            const newExams = jsonData
              .slice(1)
              .filter(row => row[0] && !isNaN(parseFloat(row[1])))
              .map(row => ({
                name: String(row[0]).trim(),
                price: parseFloat(row[1])
              }))
              .filter(exam => exam.name && exam.price > 0);

            if (newExams.length > 0) {
              db.run("DELETE FROM exams");
              const stmt = db.prepare("INSERT INTO exams (name, price) VALUES (?, ?)");
              newExams.forEach(exam => {
                stmt.run([exam.name, exam.price]);
              });
              stmt.free();
              renderPriceManagementList();
              renderExamCheckboxes(document.querySelector('#examSearch').value);
              selectedExams = selectedExams.filter(exam => newExams.some(e => e.name === exam.name));
              renderSelectedExams();
              alert('Tabela de preços atualizada com sucesso!');
            } else {
              alert('Nenhum exame válido encontrado no arquivo Excel.');
            }
          } catch (error) {
            console.error('Erro ao processar o arquivo Excel:', error);
            alert(`Erro ao processar o arquivo Excel: ${error.message}`);
          }
        };
        reader.readAsArrayBuffer(file);
      }
    }

    let debounceTimeout;
    document.getElementById('examSearch').addEventListener('input', (e) => {
      clearTimeout(debounceTimeout);
      debounceTimeout = setTimeout(() => {
        renderExamCheckboxes(e.target.value.trim());
      }, 300);
    });

    document.getElementById('discountToggle').addEventListener('click', () => {
      document.getElementById('discountSection').classList.toggle('active');
    });

    document.getElementById('enableIndustryDiscount').addEventListener('change', (e) => {
      document.getElementById('discountInput').disabled = !e.target.checked;
      validateDiscountInput('discountInput', 'discountInputError');
      updateTotal();
    });

    document.getElementById('enablePromoDiscount').addEventListener('change', (e) => {
      const isChecked = e.target.checked;
      document.getElementById('promoDiscountInput').disabled = !isChecked;
      document.getElementById('promoType').disabled = !isChecked;
      document.getElementById('promoStartDate').disabled = !isChecked;
      document.getElementById('promoEndDate').disabled = !isChecked;
      document.getElementById('otherPromoInput').disabled = !isChecked;
      document.getElementById('promoDetails').classList.toggle('active', isChecked);
      const promoType = document.getElementById('promoType').value;
      document.getElementById('otherPromoContainer').style.display = (isChecked && promoType === 'Outros') ? 'block' : 'none';
      document.getElementById('promoStartDateError').style.display = 'none';
      document.getElementById('promoEndDateError').style.display = 'none';
      document.getElementById('promoStartDate').classList.remove('error');
      document.getElementById('promoEndDate').classList.remove('error');
      validateDiscountInput('promoDiscountInput', 'promoDiscountInputError');
      updateTotal();
    });

    document.getElementById('promoType').addEventListener('change', (e) => {
      const isPromoEnabled = document.getElementById('enablePromoDiscount').checked;
      document.getElementById('otherPromoContainer').style.display = (isPromoEnabled && e.target.value === 'Outros') ? 'block' : 'none';
    });

    document.getElementById('discountInput').addEventListener('input', () => validateDiscountInput('discountInput', 'discountInputError'));
    document.getElementById('promoDiscountInput').addEventListener('input', () => validateDiscountInput('promoDiscountInput', 'promoDiscountInputError'));
    document.getElementById('applyDiscount').addEventListener('click', applyDiscount);
    document.getElementById('applyPromoDiscount').addEventListener('click', applyPromoDiscount);
    document.getElementById('clearSelection').addEventListener('click', clearSelections);

    document.getElementById('printButton').addEventListener('click', printSummary);
    document.getElementById('telefoneInput').addEventListener('input', validatePhone);
    document.getElementById('promoStartDate').addEventListener('change', validatePromoDates);
    document.getElementById('promoEndDate').addEventListener('change', validatePromoDates);
    document.getElementById('cpfInput').addEventListener('input', () => {
      const cpfInput = document.getElementById('cpfInput');
      const cpfError = document.getElementById('cpfError');
      const cpfPattern = /^\d{11}$/;
      if (!cpfPattern.test(cpfInput.value.replace(/\D/g, '')) && cpfInput.value !== '') {
        cpfInput.classList.add('error');
        cpfError.style.display = 'block';
        } else {
            cpfInput.classList.remove('error');
            cpfError.style.display = 'none';
        }
    });

    document.getElementById('updateTableButton').addEventListener('click', () => {
        document.getElementById('loginModal').classList.add('active');
    });

    document.getElementById('loginButton').addEventListener('click', handleLogin);

    document.querySelector('.close').addEventListener('click', () => {
        document.getElementById('loginModal').classList.remove('active');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('loginError').style.display = 'none';
        document.getElementById('priceManagement').classList.remove('active');
        document.querySelector('.modal-content .form-group').style.display = 'block';
        document.querySelector('.modal-content .button-container').style.display = 'block';
        document.querySelector('.modal-content h2').textContent = 'Autenticação';
    });

    document.getElementById('addExamButton').addEventListener('click', handleAddExam);

    document.getElementById('excelUpload').addEventListener('change', handleExcelUpload);

    document.getElementById('saveButton').addEventListener('click', saveChanges);

    async function initializeApp() {
        await initDatabase();
        if (db) {
            renderExamCheckboxes();
            renderSelectedExams();
        }
    }
    initializeApp();
</script>
</body>
</html>
